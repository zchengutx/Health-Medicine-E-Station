var s=(s,a,e)=>new Promise((d,l)=>{var i=s=>{try{o(e.next(s))}catch(a){l(a)}},t=s=>{try{o(e.throw(s))}catch(a){l(a)}},o=s=>s.done?d(s.value):Promise.resolve(s.value).then(i,t);o((e=e.apply(s,a)).next())});import{k as a,f as e,r as d,e as l,b as i,A as t,J as o,G as n,j as v,s as c,L as p,E as u,H as r,M as m,N as h,C as g,K as f}from"./vue-Djwh67vz.js";import{u as y,a as b,_ as k}from"./_plugin-vue_export-helper-DHCoCbLt.js";import"./index-C696E_os.js";import{v as x,F as C,g as j,d as w}from"./FeedbackButton-Dg577Pna.js";import{s as P}from"./vant-DqFfTfyr.js";import"./utils-C5DcNM9U.js";/* empty css              */const _={class:"login-view"},I={class:"login-content"},S={class:"form-section"},L={class:"input-group phone-group"},D={class:"input-wrapper"},E={class:"input-group code-group"},V={class:"input-wrapper"},z=["disabled"],A=k(a({__name:"LoginView",setup(a){f();const k=h(),A=y(),F=b(),H=e({phone:A.loginState.savedPhone||"",smsCode:""}),N=d(0),U=d(!1),q=l(()=>!x(H.phone)||N.value>0||U.value),B=l(()=>N.value>0?`获取验证码(${N.value})`:"获取验证码"),G=l(()=>x(H.phone)&&H.smsCode.length>=4),J=()=>{H.phone=H.phone.replace(/\D/g,"")},K=()=>s(this,null,function*(){if(q.value)return;const s=j(H.phone);if(s)P({message:s,type:"fail"});else try{U.value=!0,yield w.sendLoginSms(H.phone),P({message:"验证码已发送",type:"success"}),M()}catch(a){P({message:a.message||"发送验证码失败",type:"fail"})}finally{U.value=!1}}),M=()=>{N.value=60;const s=setInterval(()=>{N.value--,N.value<=0&&clearInterval(s)},1e3)},T=()=>s(this,null,function*(){if(G.value&&!U.value)try{U.value=!0;const s={DId:(yield w.login({Phone:H.phone,Password:"",SendSmsCode:H.smsCode})).DId,Name:"医生",Phone:H.phone,Email:"",Avatar:"",Status:"active"};A.login("temp_token",s,H.phone,!0),P({message:"登录成功",type:"success"}),Q()}catch(s){P({message:s.message||"登录失败",type:"fail"})}finally{U.value=!1}}),$=()=>{P({message:"密码登录功能开发中",type:"fail"})},O=()=>{F.safePush("/register")},Q=()=>{const s=k.query.redirect;s&&"/login"!==s?F.safePush(s):F.toHome()};return i(()=>{A.isLoggedIn&&A.checkTokenExpiry()&&Q()}),(s,a)=>(g(),t("div",_,[a[6]||(a[6]=o('<div class="illustration" data-v-8d790d0d><div class="medicine-bottle" data-v-8d790d0d><div class="bottle-cap" data-v-8d790d0d></div><div class="bottle-body" data-v-8d790d0d><div class="bottle-label" data-v-8d790d0d><div class="cross-icon" data-v-8d790d0d><div class="cross-horizontal" data-v-8d790d0d></div><div class="cross-vertical" data-v-8d790d0d></div></div></div></div></div><div class="pills" data-v-8d790d0d><div class="pill pill-1" data-v-8d790d0d></div><div class="pill pill-2" data-v-8d790d0d></div></div><div class="bg-clouds" data-v-8d790d0d><div class="cloud cloud-1" data-v-8d790d0d></div><div class="cloud cloud-2" data-v-8d790d0d></div><div class="cloud cloud-3" data-v-8d790d0d></div></div></div>',1)),n("div",I,[a[4]||(a[4]=n("div",{class:"header-section"},[n("h1",{class:"title"},"手机验证码登录"),n("p",{class:"subtitle"},"欢迎使用优医在线问诊医生版")],-1)),n("div",S,[n("div",L,[n("div",D,[a[2]||(a[2]=n("span",{class:"country-code"},"+86",-1)),a[3]||(a[3]=n("div",{class:"divider"},null,-1)),c(n("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>H.phone=s),type:"tel",placeholder:"请输入手机号码",class:"input-field",maxlength:"11",onInput:J},null,544),[[p,H.phone]])])]),n("div",E,[n("div",V,[c(n("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>H.smsCode=s),type:"number",placeholder:"请输入验证码",class:"input-field",maxlength:"6"},null,512),[[p,H.smsCode]]),n("button",{class:u(["code-button",{disabled:q.value}]),disabled:q.value,onClick:K},r(B.value),11,z)])]),n("div",{class:"password-login-link"},[n("span",{onClick:$},"账号密码登陆")]),v(C,{text:"登录",type:"primary",size:"large",block:"",loading:U.value,disabled:!G.value,onClick:T},null,8,["loading","disabled"]),n("div",{class:"register-link"},[n("span",{onClick:O},"注册新用户")])]),a[5]||(a[5]=n("div",{class:"footer-section"},[n("p",{class:"footer-text"},[m(" 登录即代表您同意 "),n("span",{class:"link-text"},"优医在线问诊隐私政策")])],-1))])]))}}),[["__scopeId","data-v-8d790d0d"]]);export{A as default};
