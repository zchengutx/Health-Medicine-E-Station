var e,t=Object.defineProperty,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(e,r,o)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,s=(e,t)=>{for(var s in t||(t={}))o.call(t,s)&&n(e,s,t[s]);if(r)for(var s of r(t))a.call(t,s)&&n(e,s,t[s]);return e};import{V as l,r as c,e as i,K as u}from"./vue-Djwh67vz.js";class h{static encrypt(e){try{let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e.charCodeAt(r)^this.SECRET_KEY.charCodeAt(r%this.SECRET_KEY.length));return btoa(t)}catch(t){return e}}static decrypt(e){try{const t=atob(e);let r="";for(let e=0;e<t.length;e++)r+=String.fromCharCode(t.charCodeAt(e)^this.SECRET_KEY.charCodeAt(e%this.SECRET_KEY.length));return r}catch(t){return e}}}n(h,"symbol"!=typeof(e="SECRET_KEY")?e+"":e,"doctor_app_2024");class v{static set(e,t,r=!1){try{let o=JSON.stringify(t);r&&(o=h.encrypt(o)),localStorage.setItem(e,o)}catch(o){}}static get(e,t=!1){try{let r=localStorage.getItem(e);return null===r?null:(t&&(r=h.decrypt(r)),JSON.parse(r))}catch(r){return null}}static remove(e){try{localStorage.removeItem(e)}catch(t){}}static clear(){try{localStorage.clear()}catch(e){}}static has(e){return null!==localStorage.getItem(e)}static getSize(){try{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length+t.length);return Math.round(e/1024*100)/100}catch(e){return 0}}static cleanExpired(){try{const e=Date.now(),t=[];for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);if(o&&o.endsWith("_expires")){if(parseInt(localStorage.getItem(o)||"0")<e){const e=o.replace("_expires","");t.push(o,e)}}}t.forEach(e=>localStorage.removeItem(e))}catch(e){}}static setWithExpiry(e,t,r,o=!1){const a=Date.now()+60*r*1e3;this.set(e,t,o),this.set(`${e}_expires`,a)}static getWithExpiry(e,t=!1){const r=this.get(`${e}_expires`);return r&&Date.now()>r?(this.remove(e),this.remove(`${e}_expires`),null):this.get(e,t)}}const g="doctor_token",m="doctor_info",d="remember_phone",p="last_login_time";class f{static setToken(e){v.set(g,e,!0)}static getToken(){return v.get(g,!0)}static removeToken(){v.remove(g)}static hasToken(){return v.has(g)}}class y{static setUserInfo(e){v.set(m,e,!0)}static getUserInfo(){return v.get(m,!0)}static removeUserInfo(){v.remove(m)}static hasUserInfo(){return v.has(m)}}const S=l("auth",()=>{const e=c(f.getToken()),t=c(y.getUserInfo()),r=c({isLoading:!1,lastLoginTime:v.get(p),rememberPhone:v.get(d)||!1,savedPhone:v.get("saved_phone")||""}),o=i(()=>!!e.value),a=i(()=>o.value&&!!t.value),n=i(()=>{var e;return(null==(e=t.value)?void 0:e.Name)||"医生"}),l=i(()=>{var e;return(null==(e=t.value)?void 0:e.Avatar)||""}),u=i(()=>{var e;return(null==(e=t.value)?void 0:e.Status)||"inactive"}),h=t=>{e.value=t,f.setToken(t)},g=e=>{t.value=e,y.setUserInfo(e)},m=e=>{r.value=s(s({},r.value),e),void 0!==e.lastLoginTime&&v.set(p,e.lastLoginTime),void 0!==e.rememberPhone&&v.set(d,e.rememberPhone)},S=(e,t=!1)=>{t?(v.set("saved_phone",e),r.value.savedPhone=e,r.value.rememberPhone=!0,v.set(d,!0)):(v.remove("saved_phone"),r.value.savedPhone="",r.value.rememberPhone=!1,v.set(d,!1))},_=()=>{e.value=null,t.value=null,f.removeToken(),y.removeUserInfo(),m({isLoading:!1,lastLoginTime:null})};return{token:e,doctorInfo:t,loginState:r,isLoggedIn:o,isAuthenticated:a,doctorName:n,doctorAvatar:l,doctorStatus:u,setToken:h,setDoctorInfo:g,setLoginState:m,savePhone:S,login:(e,t,r,o=!1)=>{h(e),g(t),m({lastLoginTime:Date.now(),isLoading:!1}),r&&S(r,o)},logout:_,updateDoctorInfo:e=>{t.value&&(t.value=s(s({},t.value),e),y.setUserInfo(t.value))},initAuth:()=>{v.cleanExpired();const o=f.getToken(),a=y.getUserInfo();o&&(e.value=o),a&&(t.value=a),r.value={isLoading:!1,lastLoginTime:v.get(p),rememberPhone:v.get(d)||!1,savedPhone:v.get("saved_phone")||""}},checkTokenExpiry:()=>{if(!e.value||!r.value.lastLoginTime)return!1;return!(Date.now()-r.value.lastLoginTime>6048e5)||(_(),!1)},refreshUserInfo:()=>{return r=void 0,o=null,a=function*(){var r;if(!e.value||!(null==(r=t.value)?void 0:r.DId))return!1;try{return!0}catch(o){return!1}},new Promise((e,t)=>{var n=e=>{try{l(a.next(e))}catch(r){t(r)}},s=e=>{try{l(a.throw(e))}catch(r){t(r)}},l=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,s);l((a=a.apply(r,o)).next())});var r,o,a}}}),_=()=>{const e=u();S();const t=t=>{try{e.push(t)}catch(r){window.location.href=t}},r=()=>{t("/home")};return{safePush:t,toHome:r,toLogin:()=>{t("/login")},toRegister:()=>{t("/register")},goBack:()=>{e.options.history.state.back?e.back():r()},toSplash:()=>{t("/")}}},I=(e,t)=>{const r=e.__vccOpts||e;for(const[o,a]of t)r[o]=a;return r};export{I as _,_ as a,S as u};
