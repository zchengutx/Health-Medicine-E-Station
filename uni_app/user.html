<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊàëÁöÑÂèÆÂΩì - ÂÅ•Â∫∑ÂåªÁñóÈ©øÁ´ô</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .user-page {
            min-height: 100vh;
        }
        
        .user-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
                 .avatar {
             width: 60px;
             height: 60px;
             border-radius: 30px;
             background-color: #fff;
             margin-right: 15px;
             display: flex;
             align-items: center;
             justify-content: center;
             font-size: 24px;
             overflow: hidden;
         }
         
         .avatar img {
             width: 100%;
             height: 100%;
             object-fit: cover;
             border-radius: 30px;
         }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .username {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }
        
        .user-desc {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .guide-btn {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .member-section {
            margin: 20px;
            background: #fff;
            border-radius: 10px;
            padding: 20px;
        }
        
        .member-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #333;
            color: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .member-info {
            display: flex;
            align-items: center;
        }
        
        .crown {
            font-size: 16px;
            margin-right: 8px;
        }
        
        .member-text {
            font-size: 14px;
            font-weight: bold;
        }
        
        .member-mall {
            font-size: 12px;
            color: #ccc;
        }
        
        .benefits-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .benefit-item {
            text-align: center;
            position: relative;
            cursor: pointer;
        }
        
        .benefit-number {
            display: block;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .benefit-label {
            display: block;
            font-size: 12px;
            color: #666;
        }
        
        .benefit-tag {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4d4f;
            color: #fff;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 5px;
        }
        
        .quick-access {
            margin: 20px;
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .quick-item {
            text-align: center;
            cursor: pointer;
        }
        
        .quick-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin: 0 auto 8px;
        }
        
        .quick-icon.signin {
            background: #ff6b6b;
        }
        
        .quick-icon.share {
            background: #4ecdc4;
        }
        
        .quick-icon.gift {
            background: #45b7d1;
        }
        
        .quick-icon.frequent {
            background: #96ceb4;
        }
        
        .quick-label {
            font-size: 12px;
            color: #333;
        }
        
        .order-section {
            margin: 20px;
            background: #fff;
            border-radius: 10px;
            padding: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        
        .section-more {
            font-size: 12px;
            color: #999;
            cursor: pointer;
        }
        
        .order-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .order-item {
            text-align: center;
            cursor: pointer;
        }
        
        .order-icon {
            width: 30px;
            height: 30px;
            border-radius: 15px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            margin: 0 auto 8px;
        }
        
        .order-label {
            font-size: 12px;
            color: #333;
        }
        
        .service-section {
            margin: 20px;
            background: #fff;
            border-radius: 10px;
            padding: 20px;
        }
        
        .service-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 20px;
        }
        
        .service-item {
            text-align: center;
            cursor: pointer;
        }
        
        .service-icon {
            width: 30px;
            height: 30px;
            border-radius: 15px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            margin: 0 auto 8px;
        }
        
        .service-label {
            font-size: 12px;
            color: #333;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="user-page">
        <button class="back-btn" onclick="goBack()">ËøîÂõû</button>
        
        <!-- È°∂ÈÉ®Áî®Êà∑‰ø°ÊÅØ -->
        <div class="user-header">
                         <div class="user-info" onclick="goToProfile()">
                 <div class="avatar" id="userAvatar">
                     <img id="avatarImg" src="" alt="Â§¥ÂÉè" style="display: none;">
                     <span id="avatarPlaceholder">üë§</span>
                 </div>
                 <div class="user-details">
                     <div class="username" id="username">Âä†ËΩΩ‰∏≠...</div>
                     <div class="user-desc" id="userPhone">Âä†ËΩΩ‰∏≠...</div>
                 </div>
             </div>
            <button class="guide-btn">ËçØÂ∏àÊåáÂØº‚ñ∂</button>
        </div>

        <!-- ‰ºöÂëò‰ø°ÊÅØ -->
        <div class="member-section">
            <div class="member-card">
                <div class="member-info">
                    <span class="crown">üëë</span>
                    <span class="member-text">Ê≥®ÂÜå‰ºöÂëò</span>
                </div>
                <span class="member-mall">‰ºöÂëòÂïÜÂüé ></span>
            </div>
            
            <div class="benefits-grid">
                <div class="benefit-item" onclick="handleBenefit('coupon')">
                    <span class="benefit-number">11</span>
                    <span class="benefit-label">‰ºòÊÉ†Âà∏</span>
                    <span class="benefit-tag">È¢ÜÂ•ΩÂà∏</span>
                </div>
                <div class="benefit-item" onclick="handleBenefit('coin')">
                    <span class="benefit-number">10</span>
                    <span class="benefit-label">ÂèÆÂΩìÂ∏Å</span>
                    <span class="benefit-tag">ËµöÂ∏Å</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-number">0</span>
                    <span class="benefit-label">ÊàêÈïøÂÄº</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-number">0.00</span>
                    <span class="benefit-label">ÂÅ•Â∫∑Âç°(ÂÖÉ)</span>
                </div>
            </div>
        </div>

        <!-- Âø´Êç∑ÂäüËÉΩ -->
        <div class="quick-access">
            <div class="quick-item" onclick="handleQuickAccess('signin')">
                <div class="quick-icon signin">üìÖ</div>
                <div class="quick-label">Á≠æÂà∞ÊúâÁ§º</div>
            </div>
            <div class="quick-item" onclick="handleQuickAccess('share')">
                <div class="quick-icon share">üéÅ</div>
                <div class="quick-label">ÂàÜ‰∫´È¢ÜÂà∏</div>
            </div>
            <div class="quick-item" onclick="handleQuickAccess('gift')">
                <div class="quick-icon gift">üíå</div>
                <div class="quick-label">ÁúÅÈí±Á§ºÂåÖ</div>
            </div>
            <div class="quick-item" onclick="handleQuickAccess('frequent')">
                <div class="quick-icon frequent">üõçÔ∏è</div>
                <div class="quick-label">Â∏∏Ë¥≠Ê∏ÖÂçï</div>
            </div>
        </div>

        <!-- ÊàëÁöÑËÆ¢Âçï -->
        <div class="order-section">
            <div class="section-header">
                <div class="section-title">ÊàëÁöÑËÆ¢Âçï</div>
                <div class="section-more" onclick="goToOrders()">ÂÖ®ÈÉ®ËÆ¢Âçï ></div>
            </div>
            <div class="order-grid">
                <div class="order-item" onclick="goToOrderStatus('pending')">
                    <div class="order-icon">üí∞</div>
                    <div class="order-label">ÂæÖ‰ªòÊ¨æ</div>
                </div>
                <div class="order-item" onclick="goToOrderStatus('shipping')">
                    <div class="order-icon">üì¶</div>
                    <div class="order-label">ÂæÖÂèëË¥ß</div>
                </div>
                <div class="order-item" onclick="goToOrderStatus('receiving')">
                    <div class="order-icon">üöö</div>
                    <div class="order-label">ÂæÖÊî∂Ë¥ß</div>
                </div>
                <div class="order-item" onclick="goToOrderStatus('review')">
                    <div class="order-icon">üí¨</div>
                    <div class="order-label">ÂæÖËØÑ‰ª∑</div>
                </div>
            </div>
        </div>

        <!-- ÊúçÂä°ÂäüËÉΩ -->
        <div class="service-section">
            <div class="service-grid">
                <div class="service-item" onclick="handleService('consultation')">
                    <div class="service-icon">üë®‚Äç‚öïÔ∏è</div>
                    <div class="service-label">ÂåªÁîüÈóÆËØä</div>
                </div>
                <div class="service-item" onclick="handleService('prescription')">
                    <div class="service-icon">üìã</div>
                    <div class="service-label">ÊàëÁöÑÂ§ÑÊñπ</div>
                </div>
                <div class="service-item" onclick="handleService('patient')">
                    <div class="service-icon">üë§</div>
                    <div class="service-label">Â∞±ËØä‰∫∫</div>
                </div>
                <div class="service-item" onclick="handleService('address')">
                    <div class="service-icon">üìç</div>
                    <div class="service-label">Âú∞ÂùÄÁÆ°ÁêÜ</div>
                </div>
                <div class="service-item" onclick="handleService('turntable')">
                    <div class="service-icon">üé°</div>
                    <div class="service-label">Â§ßËΩ¨Áõò</div>
                </div>
                <div class="service-item" onclick="handleService('slot')">
                    <div class="service-icon">üêØ</div>
                    <div class="service-label">ËÄÅËôéÊú∫</div>
                </div>
                <div class="service-item" onclick="handleService('allergy')">
                    <div class="service-icon">‚ö†Ô∏è</div>
                    <div class="service-label">ËøáÊïèÊåáÊï∞</div>
                </div>
                <div class="service-item" onclick="handleService('mall')">
                    <div class="service-icon">üè™</div>
                    <div class="service-label">ÂèÆÂΩìÂ∏ÅÂïÜÂüé</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅÂπ∂Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadUserInfo();
        });
        
        // È°µÈù¢ÊòæÁ§∫Êó∂Âà∑Êñ∞Áî®Êà∑‰ø°ÊÅØÔºàÁî®‰∫é‰ªéÂÖ∂‰ªñÈ°µÈù¢ËøîÂõûÊó∂Êõ¥Êñ∞ÊòæÁ§∫Ôºâ
        window.addEventListener('pageshow', function() {
            loadUserInfo();
        });

        // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
        function checkLoginStatus() {
            const token = localStorage.getItem('token');
            const userInfo = localStorage.getItem('userInfo');
            
            if (!token || !userInfo) {
                // Êú™ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ
                window.location.href = 'login.html';
            }
        }
        
        // Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ
        async function loadUserInfo() {
            console.log('=== ÂºÄÂßãÂä†ËΩΩÁî®Êà∑‰ø°ÊÅØ ===');
            
            // ÂÖà‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÔºàÂø´ÈÄüÊòæÁ§∫Ôºâ
            const userInfo = localStorage.getItem('userInfo');
            console.log('Êú¨Âú∞Â≠òÂÇ®ÁöÑÁî®Êà∑‰ø°ÊÅØ:', userInfo);
            
                         if (userInfo) {
                 const user = JSON.parse(userInfo);
                 console.log('Ëß£ÊûêÂêéÁöÑÊú¨Âú∞Áî®Êà∑‰ø°ÊÅØ:', user);
                 document.getElementById('username').textContent = user.username || 'Êú™ËÆæÁΩÆ';
                 document.getElementById('userPhone').textContent = user.phone || 'Êú™ËÆæÁΩÆ';
                 updateAvatar(user.avatar);
                 console.log('È°µÈù¢ÊòæÁ§∫Â∑≤Êõ¥Êñ∞‰∏∫Êú¨Âú∞Êï∞ÊçÆ');
             }
            
            // ÁÑ∂Âêé‰ªéÂêéÁ´ØËé∑ÂèñÊúÄÊñ∞‰ø°ÊÅØ
            try {
                const token = localStorage.getItem('token');
                console.log('ÂΩìÂâçtoken:', token);
                
                if (!token) {
                    console.log('Ê≤°ÊúâtokenÔºåË∑≥ËøáÂêéÁ´ØËØ∑Ê±Ç');
                    return;
                }
                
                console.log('Ê≠£Âú®‰ªéÂêéÁ´ØËé∑ÂèñÁî®Êà∑‰ø°ÊÅØ...');
                const response = await fetch('http://localhost:8000/v1/userInfo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token
                    },
                    body: JSON.stringify({}) // Á©∫ÁöÑËØ∑Ê±Ç‰Ωì
                });
                
                console.log('ÂêéÁ´ØÂìçÂ∫îÁä∂ÊÄÅ:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('ÂêéÁ´ØËøîÂõûÁöÑÂÆåÊï¥Êï∞ÊçÆ:', data);
                    
                    if (data.success || data.code === 0 || (data.message && data.message.includes('success'))) {
                        // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ - ‰ºòÂÖà‰ΩøÁî®ÊúçÂä°Âô®Êï∞ÊçÆ
                        const serverUserInfo = data.data || data;
                        console.log('ÊèêÂèñÁöÑÊúçÂä°Âô®Áî®Êà∑‰ø°ÊÅØ:', serverUserInfo);
                        
                        if (serverUserInfo) {
                            // Â§ÑÁêÜÂ≠óÊÆµÂêçÊò†Â∞Ñ - ÂêéÁ´ØËøîÂõûuserNameÔºåÂâçÁ´ØÊúüÊúõusername
                            const mappedUserInfo = {
                                username: serverUserInfo.userName || serverUserInfo.username,
                                phone: serverUserInfo.mobile || serverUserInfo.phone,
                                avatar: serverUserInfo.avatar
                            };
                            console.log('Â≠óÊÆµÊò†Â∞ÑÂêéÁöÑÁî®Êà∑‰ø°ÊÅØ:', mappedUserInfo);
                            
                            // ‰ºòÂÖà‰ΩøÁî®ÊúçÂä°Âô®Êï∞ÊçÆÔºåÊú¨Âú∞Êï∞ÊçÆ‰Ωú‰∏∫Ë°•ÂÖÖ
                            const localUserInfo = localStorage.getItem('userInfo');
                            const localUser = localUserInfo ? JSON.parse(localUserInfo) : {};
                            const mergedUser = { ...localUser, ...mappedUserInfo };
                            console.log('ÂêàÂπ∂ÂêéÁöÑÁî®Êà∑‰ø°ÊÅØ:', mergedUser);
                            
                            // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®
                            localStorage.setItem('userInfo', JSON.stringify(mergedUser));
                            console.log('Êú¨Âú∞Â≠òÂÇ®Â∑≤Êõ¥Êñ∞');
                            
                                                         // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
                             document.getElementById('username').textContent = mergedUser.username || 'Êú™ËÆæÁΩÆ';
                             document.getElementById('userPhone').textContent = mergedUser.phone || 'Êú™ËÆæÁΩÆ';
                             updateAvatar(mergedUser.avatar);
                             console.log('È°µÈù¢ÊòæÁ§∫Â∑≤Êõ¥Êñ∞‰∏∫ÊúçÂä°Âô®Êï∞ÊçÆ');
                             console.log('ÊúÄÁªàÊòæÁ§∫ÁöÑÁî®Êà∑Âêç:', mergedUser.username);
                             console.log('ÊúÄÁªàÊòæÁ§∫ÁöÑÊâãÊú∫Âè∑:', mergedUser.phone);
                             console.log('ÊúÄÁªàÊòæÁ§∫ÁöÑÂ§¥ÂÉè:', mergedUser.avatar);
                        }
                    } else {
                        console.log('ÂêéÁ´ØËøîÂõûÈîôËØØ:', data);
                    }
                } else {
                    console.log('HTTPÈîôËØØ:', response.status);
                    const errorText = await response.text();
                    console.log('ÈîôËØØËØ¶ÊÉÖ:', errorText);
                }
            } catch (error) {
                console.error('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', error);
                // Â¶ÇÊûúËé∑ÂèñÂ§±Ë¥•ÔºåÁªßÁª≠‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆ
            }
            
                     console.log('=== Áî®Êà∑‰ø°ÊÅØÂä†ËΩΩÂÆåÊàê ===');
     }
     
     // Êõ¥Êñ∞Â§¥ÂÉèÊòæÁ§∫
     function updateAvatar(avatarUrl) {
         const avatarImg = document.getElementById('avatarImg');
         const avatarPlaceholder = document.getElementById('avatarPlaceholder');
         
         console.log('Ê≠£Âú®Êõ¥Êñ∞Â§¥ÂÉè:', avatarUrl);
         
         if (avatarUrl && avatarUrl.trim() !== '') {
             // ÊûÑÂª∫ÂÆåÊï¥ÁöÑÂ§¥ÂÉèURL
             let fullAvatarUrl = avatarUrl;
             
             // Â¶ÇÊûúÂ§¥ÂÉèURL‰∏çÊòØ‰ª•httpÂºÄÂ§¥ÔºåÂàôÊ∑ªÂä†ÂêéÁ´ØÊúçÂä°Âô®Âú∞ÂùÄ
             if (!avatarUrl.startsWith('http')) {
                 fullAvatarUrl = `http://localhost:8000/uploads/${avatarUrl}`;
             }
             
             console.log('ÂÆåÊï¥Â§¥ÂÉèURL:', fullAvatarUrl);
             
             // ËÆæÁΩÆÂõæÁâáÊ∫êÂπ∂ÊòæÁ§∫
             avatarImg.src = fullAvatarUrl;
             avatarImg.style.display = 'block';
             avatarPlaceholder.style.display = 'none';
             
             // ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•Êó∂ÊòæÁ§∫ÈªòËÆ§Â§¥ÂÉè
             avatarImg.onerror = function() {
                 console.log('Â§¥ÂÉèÂä†ËΩΩÂ§±Ë¥•ÔºåÊòæÁ§∫ÈªòËÆ§Â§¥ÂÉè');
                 avatarImg.style.display = 'none';
                 avatarPlaceholder.style.display = 'block';
             };
             
             // ÂõæÁâáÂä†ËΩΩÊàêÂäüÊó∂ÈöêËóèÈªòËÆ§Â§¥ÂÉè
             avatarImg.onload = function() {
                 console.log('Â§¥ÂÉèÂä†ËΩΩÊàêÂäü');
                 avatarPlaceholder.style.display = 'none';
             };
         } else {
             // Ê≤°ÊúâÂ§¥ÂÉèÊó∂ÊòæÁ§∫ÈªòËÆ§Â§¥ÂÉè
             console.log('Ê≤°ÊúâÂ§¥ÂÉèÔºåÊòæÁ§∫ÈªòËÆ§Â§¥ÂÉè');
             avatarImg.style.display = 'none';
             avatarPlaceholder.style.display = 'block';
         }
     }

        // ËøîÂõûÈ¶ñÈ°µ
        function goBack() {
            window.location.href = 'index.html';
        }

        // Ë∑≥ËΩ¨Âà∞Áî®Êà∑‰ø°ÊÅØÁÆ°ÁêÜÈ°µÈù¢
        function goToProfile() {
            window.location.href = 'profile.html';
        }

        // Â§ÑÁêÜ‰ºöÂëòÁ¶èÂà©
        function handleBenefit(type) {
            alert(`${type}ÂäüËÉΩÂºÄÂèë‰∏≠`);
        }

        // Â§ÑÁêÜÂø´Êç∑ÂäüËÉΩ
        function handleQuickAccess(type) {
            alert(`${type}ÂäüËÉΩÂºÄÂèë‰∏≠`);
        }

        // Ë∑≥ËΩ¨Âà∞ËÆ¢ÂçïÈ°µÈù¢
        function goToOrders() {
            alert('ËÆ¢ÂçïÈ°µÈù¢ÂºÄÂèë‰∏≠');
        }

        // Ë∑≥ËΩ¨Âà∞ËÆ¢ÂçïÁä∂ÊÄÅÈ°µÈù¢
        function goToOrderStatus(status) {
            alert(`${status}ËÆ¢ÂçïÈ°µÈù¢ÂºÄÂèë‰∏≠`);
        }

        // Â§ÑÁêÜÊúçÂä°ÂäüËÉΩ
        function handleService(type) {
            alert(`${type}ÂäüËÉΩÂºÄÂèë‰∏≠`);
        }
    </script>
</body>
</html>
