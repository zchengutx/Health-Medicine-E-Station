<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·åŒ»ç–—é©¿ç«™ - é¦–é¡µ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¥</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .index-page {
            min-height: 100vh;
        }

        .status-bar {
            height: 44px;
            background-color: #e74c3c;
        }

        .header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .location {
            display: flex;
            align-items: center;
            margin-right: 15px;
            font-size: 14px;
            cursor: pointer;
        }

        .location-icon {
            font-size: 12px;
            margin-right: 4px;
        }

        .location-arrow {
            font-size: 10px;
            margin-left: 4px;
        }

        .search-bar {
            flex: 1;
            display: flex;
            align-items: center;
            background: white;
            border-radius: 25px;
            padding: 10px 15px;
            margin: 0 15px;
            cursor: pointer;
        }

        .search-icon {
            font-size: 14px;
            color: #999;
            margin-right: 8px;
        }

        .search-placeholder {
            font-size: 14px;
            color: #999;
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        .notification-icon {
            font-size: 18px;
            cursor: pointer;
        }

        .quick-search {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            padding: 15px 0;
            overflow-x: auto;
            white-space: nowrap;
        }

        .search-tags {
            display: flex;
            padding: 0 20px;
        }

        .tag {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            margin-right: 12px;
            white-space: nowrap;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .tag:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .main-banner {
            height: 200px;
            margin: 15px 20px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .banner-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .banner-content {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
        }

        .banner-title {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .banner-subtitle {
            display: block;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .banner-tag {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
        }

        /* åŒ»ç”Ÿåœ¨çº¿å’Œè¯å¸ˆæŒ‡å¯¼æ ·å¼ */
        .consultation-section {
            display: flex;
            gap: 15px;
            margin: 15px;
        }

        .consultation-card {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .consultation-card:hover {
            transform: translateY(-2px);
        }

        .consultation-card.doctor {
            border-left: 4px solid #e74c3c;
        }

        .consultation-card.pharmacist {
            border-left: 4px solid #27ae60;
        }

        .consultation-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .consultation-text h3 {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .consultation-text p {
            font-size: 12px;
            color: #666;
            margin: 0;
        }

        .consultation-icon {
            position: relative;
        }

        .doctor-avatar,
        .pharmacist-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .consultation-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e74c3c;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .pharmacist .consultation-badge {
            background: #27ae60;
        }

        .featured-categories {
            display: flex;
            padding: 0 20px;
            margin-bottom: 20px;
            gap: 10px;
        }

        .category-card {
            flex: 1;
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .category-card:hover {
            transform: translateY(-2px);
        }

        .category-icon {
            margin-bottom: 10px;
        }

        .icon {
            font-size: 24px;
        }

        .category-name {
            display: block;
            font-size: 13px;
            color: #333;
            margin-bottom: 5px;
        }

        .category-tag {
            background: #e74c3c;
            color: white;
            padding: 3px 6px;
            border-radius: 6px;
            font-size: 10px;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .category-nav {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
        }

        .category-item {
            display: inline-block;
            width: 20%;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .category-item:hover {
            transform: scale(1.05);
        }

        .category-icon-circle {
            width: 40px;
            height: 40px;
            background: #f8f9fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
        }

        .category-icon-circle .icon {
            font-size: 18px;
        }

        .category-label {
            font-size: 12px;
            color: #666;
        }

        .product-section {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
        }

        .loading-state, .error-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .loading-spinner {
            font-size: 24px;
            margin-bottom: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text, .error-text {
            font-size: 14px;
            color: #999;
        }

        .error-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .retry-button {
            margin-top: 15px;
            padding: 8px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .retry-button:hover {
            background-color: #0056b3;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }

        .section-more {
            font-size: 13px;
            color: #999;
            cursor: pointer;
        }

        .product-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-bottom: 10px;
        }

        .product-item {
            display: flex;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 15px;
            align-items: center;
            gap: 15px;
        }

        .product-item:hover {
            transform: translateY(-2px);
        }

        .product-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .product-image-placeholder {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            border-radius: 12px;
            flex-shrink: 0;
        }

        .product-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 0;
            line-height: 1.3;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .product-desc {
            font-size: 14px;
            color: #666;
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }

        .price {
            font-size: 16px;
            color: #e74c3c;
            font-weight: bold;
            margin-right: 5px;
        }

        .original-price {
            font-size: 12px;
            color: #999;
            text-decoration: line-through;
        }

        .new-user-banner {
            background: #e74c3c;
            margin: 0 20px 20px;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .new-user-banner:hover {
            background: #c0392b;
        }

        .banner-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .banner-text {
            font-size: 14px;
            font-weight: bold;
        }

        .banner-more {
            font-size: 13px;
            opacity: 0.8;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .quick-search::-webkit-scrollbar,
        .product-list::-webkit-scrollbar {
            display: none;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            .featured-categories {
                flex-wrap: wrap;
            }
            
            .category-card {
                flex: 1 1 calc(50% - 5px);
                margin-bottom: 10px;
            }
            
            .category-item {
                width: 25%;
            }
        }

        /* åº•éƒ¨å¯¼èˆªæ æ ·å¼ */
        .tabbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            height: 60px;
            z-index: 1000;
        }

        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: color 0.3s;
            color: #999;
            position: relative;
        }

        .tab-item.active {
            color: #e74c3c;
        }

        .tab-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .tab-text {
            font-size: 12px;
        }

        .tab-badge {
            position: absolute;
            top: 8px;
            right: 50%;
            transform: translateX(50%);
            background: #e74c3c;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            min-width: 16px;
            text-align: center;
        }

        /* ä¸ºåº•éƒ¨å¯¼èˆªæ ç•™å‡ºç©ºé—´ */
        .index-page {
            padding-bottom: 60px;
        }
    </style>
</head>
<body>
    <div class="index-page">
        <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
        <div class="status-bar"></div>
        
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="header">
            <!-- ä½ç½®é€‰æ‹© -->
            <div class="location" onclick="selectLocation()">
                <span class="location-icon">ğŸ“</span>
                <span class="location-text" id="currentLocation">ä¸œåŸåŒº</span>
                <span class="location-arrow">â–¼</span>
            </div>
            
            <!-- æœç´¢æ  -->
            <div class="search-bar" onclick="goToSearch()">
                <span class="search-icon">ğŸ”</span>
                <span class="search-placeholder">æœç´¢è¯å“ã€ç—‡çŠ¶ã€å“ç‰Œ</span>
            </div>
            
            <!-- å³ä¾§å›¾æ ‡ -->
            <div class="header-right">
                <div class="notification" onclick="goToNotification()">
                    <span class="notification-icon">ğŸ“§</span>
                </div>
            </div>
        </div>

        <!-- å¿«é€Ÿæœç´¢æ ‡ç­¾ -->
        <div class="quick-search">
            <div class="search-tags">
                <div class="tag" onclick="searchByTag('çœ¼è¯æ°´')">çœ¼è¯æ°´</div>
                <div class="tag" onclick="searchByTag('ç›Šç”ŸèŒ')">ç›Šç”ŸèŒ</div>
                <div class="tag" onclick="searchByTag('å¸ç¾æ ¼é²è‚½')">å¸ç¾æ ¼é²è‚½</div>
                <div class="tag" onclick="searchByTag('ä¸­æš‘')">ä¸­æš‘</div>
                <div class="tag" onclick="searchByTag('æµæ„Ÿ')">æµæ„Ÿ</div>
                <div class="tag" onclick="searchByTag('å‡è‚¥')">å‡è‚¥</div>
            </div>
        </div>

        <!-- ä¸»è½®æ’­å›¾ -->
        <div class="main-banner" onclick="handleBannerClick()">
            <div class="banner-content">
                <span class="banner-title">ç«‹ç§‹ç¦åˆ© å¥åº·æ¢å­£</span>
                <span class="banner-subtitle">å¥åº·å¥½ç‰©ä¸“åœº</span>
                <div class="banner-tag">éƒ¨åˆ†æ»¡78å‡10/168å‡20</div>
            </div>
        </div>

        <!-- åŒ»ç”Ÿåœ¨çº¿å’Œè¯å¸ˆæŒ‡å¯¼ -->
        <div class="consultation-section">
            <div class="consultation-card doctor" onclick="goToDoctorConsultation()">
                <div class="consultation-content">
                    <div class="consultation-text">
                        <h3>åŒ»ç”Ÿåœ¨çº¿</h3>
                        <p>å…è´¹å’¨è¯¢</p>
                    </div>
                    <div class="consultation-icon">
                        <div class="doctor-avatar">ğŸ‘¨â€âš•ï¸</div>
                        <div class="consultation-badge">ğŸ¥</div>
                    </div>
                </div>
            </div>
            <div class="consultation-card pharmacist" onclick="goToPharmacistGuidance()">
                <div class="consultation-content">
                    <div class="consultation-text">
                        <h3>è¯å¸ˆæŒ‡å¯¼</h3>
                        <p>ä¸“ä¸šè¯å¸ˆæŒ‡å¯¼</p>
                    </div>
                    <div class="consultation-icon">
                        <div class="pharmacist-avatar">ğŸ‘©â€âš•ï¸</div>
                        <div class="consultation-badge">ğŸ’Š</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç‰¹è‰²åˆ†ç±» -->
        <div class="featured-categories">
            <div class="category-card" onclick="goToCategory(1, 'å®¶åº­å¸¸å¤‡')">
                <div class="category-icon">
                    <span class="icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                </div>
                <span class="category-name">å®¶åº­å¸¸å¤‡</span>
                <div class="category-tag">éƒ¨åˆ†æ»¡78å‡10</div>
            </div>
            <div class="category-card" onclick="goToCategory(2, 'å„¿ç«¥å¥åº·')">
                <div class="category-icon">
                    <span class="icon">âš½</span>
                </div>
                <span class="category-name">å„¿ç«¥å¥åº·</span>
                <div class="category-tag">éƒ¨åˆ†æ»¡78å‡10</div>
            </div>
            <div class="category-card" onclick="goToCategory(3, 'é˜²æš‘ç”¨å“')">
                <div class="category-icon">
                    <span class="icon">â˜€ï¸</span>
                </div>
                <span class="category-name">é˜²æš‘ç”¨å“</span>
                <div class="category-tag">éƒ¨åˆ†æ»¡78å‡10</div>
            </div>
            <div class="category-card" onclick="goToCategory(4, 'çš®è‚¤ç”¨è¯')">
                <div class="category-icon">
                    <span class="icon">ğŸ©¹</span>
                </div>
                <span class="category-name">çš®è‚¤ç”¨è¯</span>
                <div class="category-tag">éƒ¨åˆ†æ»¡78å‡10</div>
            </div>
        </div>

        <!-- åœ†å½¢åˆ†ç±»å¯¼èˆª -->
        <div class="category-nav">
            <div class="category-item" onclick="goToCategory(5, 'æ„Ÿå†’å‘çƒ§')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸ¤§</span>
                </div>
                <span class="category-label">æ„Ÿå†’å‘çƒ§</span>
            </div>
            <div class="category-item" onclick="goToCategory(6, 'å’³å—½ç”¨è¯')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸ¤’</span>
                </div>
                <span class="category-label">å’³å—½ç”¨è¯</span>
            </div>
            <div class="category-item" onclick="goToCategory(7, 'æ¸…çƒ­è§£æ¯’')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸŒ¿</span>
                </div>
                <span class="category-label">æ¸…çƒ­è§£æ¯’</span>
            </div>
            <div class="category-item" onclick="goToCategory(8, 'çš®è‚¤ç”¨è¯')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸ§´</span>
                </div>
                <span class="category-label">çš®è‚¤ç”¨è¯</span>
            </div>
            <div class="category-item" onclick="goToCategory(9, 'è‚ èƒƒç”¨è¯')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸ¤¢</span>
                </div>
                <span class="category-label">è‚ èƒƒç”¨è¯</span>
            </div>
            <div class="category-item" onclick="goToCategory(10, 'å¦‡ç§‘ç”¨è¯')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸŒº</span>
                </div>
                <span class="category-label">å¦‡ç§‘ç”¨è¯</span>
            </div>
            <div class="category-item" onclick="goToCategory(11, 'ç”·ç§‘ç”¨è¯')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸ’Š</span>
                </div>
                <span class="category-label">ç”·ç§‘ç”¨è¯</span>
            </div>
            <div class="category-item" onclick="goToCategory(12, 'å„¿ç«¥ç”¨è¯')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸ‘¶</span>
                </div>
                <span class="category-label">å„¿ç«¥ç”¨è¯</span>
            </div>
            <div class="category-item" onclick="goToCategory(13, 'è€³é¼»å–‰è¯')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸ‘‚</span>
                </div>
                <span class="category-label">è€³é¼»å–‰è¯</span>
            </div>
            <div class="category-item" onclick="goToCategory(14, 'é˜²æš‘é¿æš‘')">
                <div class="category-icon-circle">
                    <span class="icon">ğŸŒ¡ï¸</span>
                </div>
                <span class="category-label">é˜²æš‘é¿æš‘</span>
            </div>
        </div>

        <!-- å•†å“æ¨è -->
        <div class="product-section">
            <div class="section-header">
                <span class="section-title">çƒ­é—¨æ¨è</span>
                <span class="section-more" onclick="goToMore()">æ›´å¤š ></span>
            </div>
            
            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="productLoadingState" class="loading-state" style="display: none;">
                <div class="loading-spinner">â³</div>
                <div class="loading-text">æ­£åœ¨åŠ è½½è¯å“æ•°æ®...</div>
            </div>
            
            <!-- é”™è¯¯çŠ¶æ€ -->
            <div id="productErrorState" class="error-state" style="display: none;">
                <div class="error-icon">âŒ</div>
                <div class="error-text">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>
                <button class="retry-button" onclick="loadProductData()">é‡æ–°åŠ è½½</button>
            </div>
            
            <!-- è¯å“åˆ—è¡¨ -->
            <div id="productList" class="product-list">
                <!-- åŠ¨æ€åŠ è½½çš„è¯å“æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>
        </div>

        <!-- æ–°äººä¸“äº« -->
        <div class="new-user-banner" onclick="goToNewUserOffer()">
            <div class="banner-content">
                <span class="banner-text">æ–°äººä¸“äº«ç‰¹æƒ  å•å“ä½è‡³1å…ƒ</span>
                <span class="banner-more">æ›´å¤š ></span>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <div class="tabbar">
        <div class="tab-item active" onclick="switchTab('home')">
            <div class="tab-icon">ğŸ </div>
            <div class="tab-text">é¦–é¡µ</div>
        </div>
        <div class="tab-item" onclick="switchTab('mall')">
            <div class="tab-icon">ğŸ›’</div>
            <div class="tab-text">å®å½“å•†åŸ</div>
        </div>
        <div class="tab-item" onclick="switchTab('group')">
            <div class="tab-icon">ğŸ¯</div>
            <div class="tab-text">ç‰¹ä»·æ‹¼å›¢</div>
        </div>
        <div class="tab-item" onclick="switchTab('cart')">
            <div class="tab-icon">ğŸ“‹</div>
            <div class="tab-text">æ¸…å•åˆ—è¡¨</div>
            <div class="tab-badge">99</div>
        </div>
        <div class="tab-item" onclick="switchTab('user')">
            <div class="tab-icon">ğŸ‘¤</div>
            <div class="tab-text">æˆ‘çš„</div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¦–é¡µåŠ è½½å®Œæˆ');
            loadData();
            loadProductData();
        });

        // åŠ è½½æ•°æ®
        function loadData() {
            console.log('é¦–é¡µæ•°æ®åŠ è½½å®Œæˆ');
        }

        // åŠ è½½è¯å“æ•°æ®
        async function loadProductData() {
            const loadingState = document.getElementById('productLoadingState');
            const errorState = document.getElementById('productErrorState');
            const productList = document.getElementById('productList');

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showLoadingState();

                console.log('ğŸ“¦ å¼€å§‹åŠ è½½è¯å“æ•°æ®...');

                // è°ƒç”¨è¯å“åˆ—è¡¨API
                const response = await fetch('http://localhost:8888/v1/drug/list', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        frist_category_id: 0,
                        second_category_id: 0,
                        keyword: ''
                    })
                });

                console.log('ğŸ“¡ APIå“åº”çŠ¶æ€:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('âœ… è¯å“æ•°æ®APIå“åº”:', data);
                console.log('ğŸ” è¯¦ç»†æ•°æ®æ£€æŸ¥:');
                console.log('- data.drug:', data.drug);
                console.log('- data.drug.length:', data.drug ? data.drug.length : 'undefined');
                if (data.drug && data.drug.length > 0) {
                    console.log('- ç¬¬ä¸€ä¸ªè¯å“æ•°æ®:', data.drug[0]);
                    console.log('- ç¬¬ä¸€ä¸ªè¯å“çš„drug_name:', data.drug[0].drug_name);
                    console.log('- ç¬¬ä¸€ä¸ªè¯å“çš„æ‰€æœ‰å­—æ®µ:', Object.keys(data.drug[0]));
                }

                if (data.code != 0) {
                    throw new Error(data.msg || 'APIè°ƒç”¨å¤±è´¥');
                }

                // æ˜¾ç¤ºè¯å“æ•°æ®
                displayProducts(data.drug || []);
                hideLoadingState();

            } catch (error) {
                console.error('âŒ åŠ è½½è¯å“æ•°æ®å¤±è´¥:', error);
                showErrorState();
            }
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoadingState() {
            document.getElementById('productLoadingState').style.display = 'block';
            document.getElementById('productErrorState').style.display = 'none';
            document.getElementById('productList').style.display = 'none';
        }

        // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
        function showErrorState() {
            document.getElementById('productLoadingState').style.display = 'none';
            document.getElementById('productErrorState').style.display = 'block';
            document.getElementById('productList').style.display = 'none';
        }

        // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºè¯å“åˆ—è¡¨
        function hideLoadingState() {
            document.getElementById('productLoadingState').style.display = 'none';
            document.getElementById('productErrorState').style.display = 'none';
            document.getElementById('productList').style.display = 'flex';
        }

        // æ˜¾ç¤ºè¯å“æ•°æ®
        function displayProducts(drugs) {
            const productList = document.getElementById('productList');
            
            // æ·»åŠ è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
            console.log('=== displayProducts å‡½æ•°è°ƒè¯• ===');
            console.log('ä¼ å…¥çš„drugså‚æ•°:', drugs);
            console.log('drugsç±»å‹:', typeof drugs);
            console.log('æ˜¯å¦ä¸ºæ•°ç»„:', Array.isArray(drugs));
            console.log('æ•°ç»„é•¿åº¦:', drugs ? drugs.length : 'undefined');
            
            if (!drugs || drugs.length === 0) {
                console.log('âŒ æ²¡æœ‰è¯å“æ•°æ®ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€');
                productList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999; width: 100%;">
                        <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“¦</div>
                        <div>æš‚æ— è¯å“æ•°æ®</div>
                        <div style="font-size: 12px; color: #ccc; margin-top: 10px;">è°ƒè¯•: drugs=${drugs}, length=${drugs ? drugs.length : 'N/A'}</div>
                    </div>
                `;
                return;
            }

            // åªæ˜¾ç¤ºå‰4ä¸ªè¯å“ä½œä¸ºçƒ­é—¨æ¨è
            const displayDrugs = drugs.slice(0, 4);
            console.log('å‡†å¤‡æ˜¾ç¤ºçš„è¯å“:', displayDrugs);
            
            const productsHTML = displayDrugs.map((drug, index) => {
                console.log(`å¤„ç†ç¬¬${index + 1}ä¸ªè¯å“:`, drug);
                console.log(`- drug.drug_name:`, drug.drug_name);
                console.log(`- drug.specification:`, drug.specification);
                console.log(`- drug.price:`, drug.price);
                console.log(`- æ‰€æœ‰å­—æ®µ:`, Object.keys(drug));
                
                const drugName = drug.drugName || drug.drug_name || 'æœªçŸ¥è¯å“';
                const specification = drug.specification || 'è§„æ ¼å¾…ç¡®è®¤';
                const price = drug.price ? drug.price.toFixed(2) : '0.00';
                const originalPrice = drug.price ? (drug.price * 1.2).toFixed(2) : '0.00';
                
                console.log(`- æœ€ç»ˆæ˜¾ç¤ºåç§°: "${drugName}"`);
                console.log(`- æœ€ç»ˆæ˜¾ç¤ºè§„æ ¼: "${specification}"`);
                
                // è·å–è¯å“IDï¼Œå°è¯•å¤šç§å¯èƒ½çš„å­—æ®µå
                const drugId = drug.id || drug.Id || index + 1;
                
                return `
                    <div class="product-item" onclick="goToProduct(${drugId})">
                        <div class="product-image-placeholder">ğŸ’Š</div>
                        <div class="product-info">
                            <span class="product-name">${drugName}</span>
                            <span class="product-desc">${specification}</span>
                            <div class="product-price">
                                <span class="price">Â¥${price}</span>
                                <span class="original-price">Â¥${originalPrice}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            productList.innerHTML = productsHTML;
            console.log(`âœ… å·²æ˜¾ç¤º ${displayDrugs.length} ä¸ªè¯å“`);
            console.log('=== displayProducts å‡½æ•°è°ƒè¯•ç»“æŸ ===');
        }

        // é€‰æ‹©ä½ç½®
        function selectLocation() {
            alert('ä½ç½®é€‰æ‹©åŠŸèƒ½å¼€å‘ä¸­');
        }

        // è·³è½¬åˆ°æœç´¢é¡µ
        function goToSearch() {
            window.location.href = 'search.html';
        }

        // è·³è½¬åˆ°é€šçŸ¥é¡µ
        function goToNotification() {
            window.location.href = 'notification.html';
        }

        // æŒ‰æ ‡ç­¾æœç´¢
        function searchByTag(tag) {
            window.location.href = `search.html?keyword=${encodeURIComponent(tag)}`;
        }

        // è½®æ’­å›¾ç‚¹å‡»
        function handleBannerClick() {
            console.log('ç‚¹å‡»è½®æ’­å›¾');
            // æ ¹æ®bannerç±»å‹è·³è½¬åˆ°ç›¸åº”é¡µé¢
        }

        // åŒ»ç”Ÿåœ¨çº¿å’¨è¯¢
        function goToDoctorConsultation() {
            window.location.href = 'doctor-list.html';
        }

        // è¯å¸ˆæŒ‡å¯¼
        function goToPharmacistGuidance() {
            alert('è¯å¸ˆæŒ‡å¯¼åŠŸèƒ½å¼€å‘ä¸­');
        }

        // è·³è½¬åˆ°åˆ†ç±»é¡µ
        function goToCategory(id, name) {
            window.location.href = `category.html?id=${id}&name=${encodeURIComponent(name)}`;
        }

        // è·³è½¬åˆ°å•†å“è¯¦æƒ…
        function goToProduct(id) {
            if (!id || id === 'null') {
                console.error('è¯å“IDæ— æ•ˆ:', id);
                alert('è¯å“IDæ— æ•ˆï¼Œæ— æ³•æŸ¥çœ‹è¯¦æƒ…');
                return;
            }
            console.log('è·³è½¬åˆ°è¯å“è¯¦æƒ…é¡µï¼ŒID:', id);
            window.location.href = `product-detail.html?id=${id}`;
        }

        // è·³è½¬åˆ°æ›´å¤šé¡µé¢
        function goToMore() {
            window.location.href = 'product-list.html';
        }

        // è·³è½¬åˆ°æ–°äººä¸“äº«
        function goToNewUserOffer() {
            window.location.href = 'new-user.html';
        }

        // åº•éƒ¨å¯¼èˆªæ åˆ‡æ¢
        function switchTab(tab) {
            // æ ¹æ®tabç±»å‹è·³è½¬åˆ°ç›¸åº”é¡µé¢
            const pages = {
                'home': 'index.html',
                'mall': 'mall.html',
                'group': 'group.html',
                'cart': 'cart.html',
                'user': 'user.html'
            };
            
            const targetPage = pages[tab];
            if (targetPage && targetPage !== 'index.html') {
                // ç›´æ¥è·³è½¬åˆ°å¯¹åº”é¡µé¢
                console.log(`åˆ‡æ¢åˆ°: ${targetPage}`);
                window.location.href = targetPage;
            }
        }
    </script>
</body>
</html>
