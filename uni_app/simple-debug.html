<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•è°ƒè¯• - è¯å“API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-info { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe6e6; }
        .success { background: #e6ffe6; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” è¯å“APIç®€å•è°ƒè¯•</h1>
    
    <button onclick="quickTest()">å¿«é€Ÿæµ‹è¯•API</button>
    
    <div id="output"></div>

    <script>
        function addOutput(message, type = 'info') {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = `debug-info ${type}`;
            
            if (typeof message === 'object') {
                div.innerHTML = `<pre>${JSON.stringify(message, null, 2)}</pre>`;
            } else {
                div.textContent = message;
            }
            
            output.appendChild(div);
        }

        async function quickTest() {
            document.getElementById('output').innerHTML = '';
            addOutput('å¼€å§‹å¿«é€Ÿæµ‹è¯•...', 'info');

            try {
                addOutput('æ­¥éª¤1: å‘é€APIè¯·æ±‚');
                
                const response = await fetch('http://localhost:8888/v1/drug/list', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        frist_category_id: 0,
                        second_category_id: 0,
                        keyword: ''
                    })
                });

                addOutput(`æ­¥éª¤2: æ”¶åˆ°å“åº” - çŠ¶æ€ç : ${response.status}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                addOutput('æ­¥éª¤3: è§£æJSONå“åº”');
                addOutput(data, 'success');

                addOutput('æ­¥éª¤4: åˆ†ææ•°æ®ç»“æ„');
                addOutput(`- code: ${data.code} (${typeof data.code})`);
                addOutput(`- msg: ${data.msg}`);
                addOutput(`- drug: ${Array.isArray(data.drug) ? `æ•°ç»„ï¼Œé•¿åº¦${data.drug.length}` : typeof data.drug}`);

                if (data.drug && data.drug.length > 0) {
                    addOutput('æ­¥éª¤5: æ£€æŸ¥ç¬¬ä¸€ä¸ªè¯å“æ•°æ®');
                    const firstDrug = data.drug[0];
                    addOutput(firstDrug, 'success');
                    
                    addOutput('æ­¥éª¤6: æ£€æŸ¥å­—æ®µ');
                    addOutput(`- drug_name: "${firstDrug.drug_name}"`);
                    addOutput(`- drugName: "${firstDrug.drugName}"`);
                    addOutput(`- specification: "${firstDrug.specification}"`);
                    addOutput(`- price: ${firstDrug.price}`);
                    addOutput(`- æ‰€æœ‰å­—æ®µ: ${Object.keys(firstDrug).join(', ')}`);

                    // æ£€æŸ¥å¤šç§å¯èƒ½çš„å­—æ®µå
                    const possibleNames = ['drug_name', 'drugName', 'DrugName', 'name'];
                    let foundName = null;
                    
                    for (let fieldName of possibleNames) {
                        if (firstDrug[fieldName]) {
                            foundName = fieldName;
                            addOutput(`âœ… æ‰¾åˆ°è¯å“åç§°å­—æ®µ: ${fieldName} = "${firstDrug[fieldName]}"`, 'success');
                            break;
                        }
                    }
                    
                    if (!foundName) {
                        addOutput('âŒ å‘ç°é—®é¢˜: æ‰¾ä¸åˆ°è¯å“åç§°å­—æ®µ!', 'error');
                        addOutput('å®Œæ•´çš„è¯å“æ•°æ®:', 'error');
                        addOutput(firstDrug, 'error');
                    }
                } else {
                    addOutput('âŒ æ²¡æœ‰è¯å“æ•°æ®!', 'error');
                }

            } catch (error) {
                addOutput(`âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
