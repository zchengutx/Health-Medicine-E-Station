syntax = "proto3";

package api.prescription.v1;

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";

option go_package = "doctors/api/prescription/v1;v1";
option java_multiple_files = true;
option java_package = "api.prescription.v1";

// 处方管理服务
service Prescription {
  // 创建处方
  rpc CreatePrescription(CreatePrescriptionReq) returns (CreatePrescriptionResp) {
    option (google.api.http) = {
      post: "/api/v1/prescription/create"
      body: "*"
    };
  }
  
  // 更新处方
  rpc UpdatePrescription(UpdatePrescriptionReq) returns (UpdatePrescriptionResp) {
    option (google.api.http) = {
      put: "/api/v1/prescription/{prescription_id}"
      body: "*"
    };
  }
  
  // 确认处方
  rpc ConfirmPrescription(ConfirmPrescriptionReq) returns (ConfirmPrescriptionResp) {
    option (google.api.http) = {
      post: "/api/v1/prescription/{prescription_id}/confirm"
      body: "*"
    };
  }
  
  // 取消处方
  rpc CancelPrescription(CancelPrescriptionReq) returns (CancelPrescriptionResp) {
    option (google.api.http) = {
      post: "/api/v1/prescription/{prescription_id}/cancel"
      body: "*"
    };
  }
  
  // 获取处方详情
  rpc GetPrescription(GetPrescriptionReq) returns (GetPrescriptionResp) {
    option (google.api.http) = {
      get: "/api/v1/prescription/{prescription_id}"
    };
  }
  
  // 处方列表
  rpc ListPrescriptions(ListPrescriptionsReq) returns (ListPrescriptionsResp) {
    option (google.api.http) = {
      get: "/api/v1/prescriptions"
    };
  }
  
  // 药品搜索
  rpc SearchMedicines(SearchMedicinesReq) returns (SearchMedicinesResp) {
    option (google.api.http) = {
      get: "/api/v1/medicines/search"
    };
  }
  
  // 药物相互作用检查
  rpc CheckDrugInteractions(CheckDrugInteractionsReq) returns (CheckDrugInteractionsResp) {
    option (google.api.http) = {
      post: "/api/v1/medicines/check-interactions"
      body: "*"
    };
  }
}

// 处方状态枚举
enum PrescriptionStatus {
  PRESCRIPTION_STATUS_UNSPECIFIED = 0;
  PRESCRIPTION_STATUS_DRAFT = 1;
  PRESCRIPTION_STATUS_PENDING = 2;
  PRESCRIPTION_STATUS_CONFIRMED = 3;
  PRESCRIPTION_STATUS_DISPENSED = 4;
  PRESCRIPTION_STATUS_CANCELLED = 5;
}

// 处方类型枚举
enum PrescriptionType {
  PRESCRIPTION_TYPE_UNSPECIFIED = 0;
  PRESCRIPTION_TYPE_WESTERN = 1;
  PRESCRIPTION_TYPE_CHINESE = 2;
  PRESCRIPTION_TYPE_MIXED = 3;
}

// 处方信息
message PrescriptionInfo {
  uint64 id = 1; // 处方ID
  string prescription_no = 2; // 处方编号
  uint64 doctor_id = 3; // 医生ID
  uint64 patient_id = 4; // 患者ID
  uint64 medical_record_id = 5; // 病历ID
  string prescription_date = 6; // 开方日期
  double total_amount = 7; // 总金额
  PrescriptionType prescription_type = 8; // 处方类型
  string usage_instruction = 9; // 用法说明
  PrescriptionStatus status = 10; // 处方状态
  uint64 auditor_id = 11; // 审核人ID
  string audit_time = 12; // 审核时间
  string audit_notes = 13; // 审核备注
  repeated PrescriptionMedicineInfo medicines = 14; // 药品列表
  string created_at = 15; // 创建时间
  string updated_at = 16; // 更新时间
}

// 处方药品信息
message PrescriptionMedicineInfo {
  uint64 id = 1; // 处方药品ID
  uint64 prescription_id = 2; // 处方ID
  uint64 medicine_id = 3; // 药品ID
  string medicine_name = 4; // 药品名称
  string medicine_code = 5; // 药品编码
  string specification = 6; // 规格
  string manufacturer = 7; // 生产厂家
  double quantity = 8; // 数量
  string unit = 9; // 单位
  double unit_price = 10; // 单价
  double total_price = 11; // 总价
  string dosage = 12; // 剂量
  string frequency = 13; // 频次
  string duration = 14; // 用药天数
  string usage_method = 15; // 用法
  string notes = 16; // 备注
}

// 药品信息
message MedicineInfo {
  uint64 id = 1; // 药品ID
  string medicine_code = 2; // 药品编码
  string name = 3; // 药品名称
  string generic_name = 4; // 通用名
  string brand_name = 5; // 品牌名
  string specification = 6; // 规格
  string dosage_form = 7; // 剂型
  string manufacturer = 8; // 生产厂家
  string approval_number = 9; // 批准文号
  string category = 10; // 分类
  string prescription_type = 11; // 处方类型
  string unit = 12; // 单位
  double price = 13; // 单价
  string indications = 14; // 适应症
  string contraindications = 15; // 禁忌症
  string side_effects = 16; // 不良反应
  string dosage_usage = 17; // 用法用量
  string storage_conditions = 18; // 储存条件
  int32 shelf_life = 19; // 保质期（月）
  string image_url = 20; // 图片链接
  string status = 21; // 状态
  double stock_quantity = 22; // 库存数量
  double available_quantity = 23; // 可用库存
  double min_stock_level = 24; // 最低库存
}

// 药物相互作用信息
message DrugInteractionInfo {
  uint64 medicine_id_1 = 1; // 药品1 ID
  string medicine_name_1 = 2; // 药品1名称
  uint64 medicine_id_2 = 3; // 药品2 ID
  string medicine_name_2 = 4; // 药品2名称
  string severity = 5; // 严重程度
  string description = 6; // 描述
  string recommendation = 7; // 建议
}

// 创建处方请求
message CreatePrescriptionReq {
  uint64 doctor_id = 1; // 医生ID
  uint64 patient_id = 2; // 患者ID
  uint64 medical_record_id = 3; // 病历ID
  PrescriptionType prescription_type = 4; // 处方类型
  string usage_instruction = 5; // 用法说明
  repeated CreatePrescriptionMedicineReq medicines = 6; // 药品列表
}

// 创建处方药品请求
message CreatePrescriptionMedicineReq {
  uint64 medicine_id = 1; // 药品ID
  double quantity = 2; // 数量
  string dosage = 3; // 剂量
  string frequency = 4; // 频次
  string duration = 5; // 用药天数
  string usage_method = 6; // 用法
  string notes = 7; // 备注
}

// 创建处方响应
message CreatePrescriptionResp {
  string message = 1; // 返回信息
  int64 code = 2; // 返回码
  PrescriptionInfo prescription = 3; // 处方信息
}

// 更新处方请求
message UpdatePrescriptionReq {
  uint64 prescription_id = 1; // 处方ID
  PrescriptionType prescription_type = 2; // 处方类型
  string usage_instruction = 3; // 用法说明
  repeated UpdatePrescriptionMedicineReq medicines = 4; // 药品列表
}

// 更新处方药品请求
message UpdatePrescriptionMedicineReq {
  uint64 medicine_id = 1; // 药品ID
  double quantity = 2; // 数量
  string dosage = 3; // 剂量
  string frequency = 4; // 频次
  string duration = 5; // 用药天数
  string usage_method = 6; // 用法
  string notes = 7; // 备注
}

// 更新处方响应
message UpdatePrescriptionResp {
  string message = 1; // 返回信息
  int64 code = 2; // 返回码
  PrescriptionInfo prescription = 3; // 处方信息
}

// 确认处方请求
message ConfirmPrescriptionReq {
  uint64 prescription_id = 1; // 处方ID
}

// 确认处方响应
message ConfirmPrescriptionResp {
  string message = 1; // 返回信息
  int64 code = 2; // 返回码
  PrescriptionInfo prescription = 3; // 处方信息
}

// 取消处方请求
message CancelPrescriptionReq {
  uint64 prescription_id = 1; // 处方ID
}

// 取消处方响应
message CancelPrescriptionResp {
  string message = 1; // 返回信息
  int64 code = 2; // 返回码
  PrescriptionInfo prescription = 3; // 处方信息
}

// 获取处方详情请求
message GetPrescriptionReq {
  uint64 prescription_id = 1; // 处方ID
}

// 获取处方详情响应
message GetPrescriptionResp {
  PrescriptionInfo prescription = 1; // 处方信息
}

// 处方列表请求
message ListPrescriptionsReq {
  uint64 doctor_id = 1; // 医生ID
  uint64 patient_id = 2; // 患者ID
  PrescriptionStatus status = 3; // 处方状态
  int32 page = 4; // 页码
  int32 page_size = 5; // 每页数量
}

// 处方列表响应
message ListPrescriptionsResp {
  repeated PrescriptionInfo prescriptions = 1; // 处方列表
  int32 total = 2; // 总数
}

// 药品搜索请求
message SearchMedicinesReq {
  string keyword = 1; // 关键字
  int32 page = 2; // 页码
  int32 page_size = 3; // 每页数量
}

// 药品搜索响应
message SearchMedicinesResp {
  repeated MedicineInfo medicines = 1; // 药品列表
  int32 total = 2; // 总数
}

// 药物相互作用检查请求
message CheckDrugInteractionsReq {
  repeated uint64 medicine_ids = 1; // 药品ID列表
}

// 药物相互作用检查响应
message CheckDrugInteractionsResp {
  repeated DrugInteractionInfo interactions = 1; // 相互作用信息列表
}